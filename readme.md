# LAB09

## ส่วนที่ 1 : การทำความเข้าใจโค้ด

**1.1 เหตุใดจึงต้องแยก duration และ timeLeftออกจากกัน อธิบายความแตกต่าง**

**ตอบ**

- duration คือ เวลาทั้งหมดที่เราตั้งไว้ตั้งแต่แรก
- timeLeft คือ เวลาที่เหลืออยู่จริงขณะนับถอยหลัง
- การแยกกันทำให้รู้เวลาเริ่มต้นของ task และสามารถ reset หรือคำนวณความคืบหน้าได้ง่าย

**1.2 formatTime() ฟังก์ชันนี้ทำความสำคัญอะไร? ถ้าไม่มีฟังก์ชันนี้ app จะเป็นยังไง**

**ตอบ**

- formatTime() ใช้แปลงวินาทีให้เป็นรูปแบบ นาที:วินาที เพื่อให้ผู้ใช้ดูเวลาได้ง่ายถ้าไม่มี ฟังก์ชันนี้ แอปจะแสดงเวลาเป็นตัวเลขวินาทีซึ่งดูยาก

**1.3 อธิบายข้อแตกต่างระหว่าง setInterval() และ setTimeout()**

**ตอบ**

- **setInterval()** จะทำงานซ้ำๆทุกช่วงเวลา ตามเวลาที่กำหนด เช่น ทุก 1 วินาที เหมาะกับการทำ timer หรือนับถอยหลัง
- **setTimeout()** จะทำงานครั้งเดียวหลังจากครบเวลาที่กำหนด ไม่วนซ้ำ เช่น รอ 3 วินาทีแล้วค่อยแสดงข้อความ

## ส่วนที่ 2 : ฟังก์ชันการทำงาน

**2.1เมื่อผู้ใช้คลิกปุ่ม "▶️ เริ่ม" ครั้งแรก เกิดอะไรขึ้นในลำดับใด (ระบุขั้นตอนอย่างน้อย 4 ขั้น)**

**ตอบ**

- 1. เรียกฟังก์ชัน toggleTimer(id)
- 2. เปลี่ยนค่า task.isRunning เป็น true
- 3. สร้าง setInterval() ให้นับเวลาทุก 1 วินาที
- 4. ลดค่า timeLeft ลงทีละ 1
- 5. เรียก renderTasks() เพื่ออัปเดตหน้าจอ

**2.2 ในฟังก์ชัน toggleTimer() ทำไมจึงต้องมี clearInterval() ก่อนแล้วจึงตั้ง task.isRunning = false**

**ตอบ**

- เพื่อหยุดการนับเวลาอย่างสมบูรณ์ถ้าไม่หยุด intervalก่อน timer จะยังทำงานอยู่แม้สถานะจะเป็นหยุดแล้ว

**2.3ถ้า timer หมดเวลา จะเกิดความผิดพลาดใดหากไม่มี clearInterval()**

**ตอบ**

- timer จะยังทำงานต่อ
- timeLeft() อาจจะติดลบ
- เกิด bug และสิ้นเปลืองหน่วยความจำ

## ส่วนที่ 3 : DOM และ UI

**3.1 ฟังก์ชัน renderTasks() สามารถแยกออกเป็นฟังก์ชันย่อยได้กี่ฟังก์ชัน จงเสนอการแยกที่เหมาะสม**

**ตอบ** 3 ฟังก์ชันย่อย ได้แก่

- renderEmptyState()
- renderTaskItem(task)
- renderTaskList(tasks)

**3.2ใช้วิธีใดในการอัปเดต UI ทุกครั้งที่ timer เปลี่ยนแปลง มีวิธีการอื่นนอกเหนือจำนวนปัจจุบันหรือไม่**

**ตอบ**

- ใช้การเรียก renderTasks() ทุกครั้งที่ข้อมูลเปลี่ยน
- วิธีอื่น : อัปเดตเฉพาะ DOM ที่เปลี่ยน

**3.3 "keypress" event listener ทำความสำคัญอะไร หากลบออกไป app จะเป็นยังไง**

**ตอบ**

- ทำให้กด Enter เพื่อเพิ่ม task ระบบจะเรียก addTask() ทันที
  ช่วยให้เพิ่ม task ได้สะดวก โดยไม่ต้องใช้เมาส์
- ถ้าลบออกผู้ใช้จะ กด Enter แล้วไม่เกิดอะไรขึ้น ต้องกดปุ่มเพิ่มเท่านั้น

## ส่วนที่ 4 : Web Audio API

**4.1 อธิบายหน้าที่ของการตั้งค่า:**

- oscillator.frequency.value = 800
- oscillator.type = "sine"
- gainNode.gain.setValueAtTime(0.3, audioContext.currentTime)

**ตอบ**

- frequency = 800 คือ ความแหลมของเสียง
- type = "sine" คือ เสียงนุ่ม ไม่แหลมเกิน
- gain = 0.3 คือ ระดับความดังของเสียง

**4.2ทำไมเสียง alarm จึงใช้เวลา 0.5 วินาที แล้วหยุด ถ้าเพิ่มเป็น 2 วินาทีจะส่งผลต่อ UX อย่างไร**

**ตอบ**

- ไม่รบกวนผู้ใช้ และ แจ้งเตือนพอดี
- ถ้า 2 วินาที อาจดังนานเกิน และ น่ารำคาญ

## ส่วนที่ 5 : Array Methods

**5.1ในฟังก์ชัน deleteTask(id) ใช้ filter() เพื่ออะไร เขียนวิธีอื่นแทน filter() ได้หรือไม่**

**ตอบ**

- เราใช้ filter() เพื่อ ลบ task ที่มี id ตรงกันออกจาก array
- ใช้วิะีอื่นได้ จะใช้ findIndex() + splice()

**5.2ในฟังก์ชัน renderTasks() ใช้ map() เพื่อทำอะไร ถ้าใช้ forEach() แทนจะดีหรือไม่**

**ตอบ**

- map() ใช้เพื่อแปลง atsk แต่ละตัวเป็น HTML
- forEach() ไม่เหมาะ เพราะ ไม่ return ค่า

## ส่วนที่ 6 : ข้อบกพร่องและการแก้ไข

**6.1หากผู้ใช้เพิ่ม task 2 อัน แล้วคลิก "เริ่ม" บน task ทั้ง 2 อันพร้อมๆ กัน จะเกิดอะไรขึ้น**

**ตอบ**

- timer ทั้งสองจะนับพร้อมกัน (ไม่มีข้อผิดพลาด แต่ UX อาจไม่ดี)

**6.2ถ้า timer กำลังเดินอยู่ และผู้ใช้รีเฟรชหน้า (F5) task จะหายไป ทำไม วิธีแก้ปัญหาคือ**

**ตอบ**

- เพราะข้อมูลอยู่ใน memory วิธีแก้คือ **ใช้ LocalStorage**

**6.3ในการทดสอบ app ที่ timer 30 นาที จะใช้เวลานานไปหรือไม่ เสนอวิธีทดสอบที่เร็วขึ้น**

**ตอบ**

- ลดเวลาเป็น 10 - 30 วินาที
- ใช้ค่าทดสอบแทนค่าจริง

## ส่วนที่ 7 : Enhancement

**7.1หากต้องการเพิ่มฟังก์ชัน "รีเซ็ต timer" คืนไปเป็น 30 นาที โค้ดจะเป็นยังไง**

**ตอบ**

- ตั้งค่า task.timeLeft = task.duration แล้วเรียก renderTasks()

**7.2วิธีใดในการเก็บ tasks ไว้ใน LocalStorage เพื่อไม่ให้หายเมื่อรีเฟรชหน้า**

**ตอบ**

- บันทึก tasks ด้วย JSON.stringify()
- โหลดกลับด้วย JSON.parse() ตอนเริ่มแอป

**7.3ถ้าต้องการให้ผู้ใช้กำหนดเวลา timer เอง จะต้องแก้ไขฟังก์ชันไหนบ้าง**

**ตอบ**

- แก้ตรง addTask()
- UI input เวลา
- ค่า duration และ timeLeft

## ส่วนที่ 8 : Concepts เชิงลึก

**8.1 ทำไม renderTasks() จึงต้องเรียกหลายครั้ง มีวิธี DRY ที่ดีกว่าหรือไม่**

**ตอบ**

- เพื่อให้ UI ตรงกับข้อมูลล่าสุด
  แนวคิด DRY : อัปเดตเฉพาะส่วนที่เปลี่ยน

**8.2ถ้าเปลี่ยนจาก setInterval เป็น requestAnimationFrame จะส่งผลดีหรือไม่**

**ตอบ**

- ไม่เหมาะ เพราะ timer ไม่ต้องการเฟรมเรตสูง
  setInterval() เหมาะกว่า

**8.3ในโค้ดที่ใช้ setInterval() มี Memory Leak ที่อาจเกิดขึ้นได้หรือไม่**

**ตอบ**

- มี ถ้าไม่ clearInterval() ตอนลบ task
  interval จะค้างอยู่ในหน่วยความจำ
